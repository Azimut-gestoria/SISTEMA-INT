<!DOCTYPE html>
<html lang="en" dir="">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Nuevo Caso</title>
    <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,400i,600,700,800,900" rel="stylesheet" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../dist-assets/css/themes/lite-purple.min.css" rel="stylesheet" />
    <link href="../../dist-assets/css/plugins/perfect-scrollbar.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../dist-assets/css/plugins/sweetalert2.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">



</head>

<body class="text-left">
    <div class="app-admin-wrap layout-horizontal-bar">
        <div class="main-header">
            <div class="logo"><img src="../../dist-assets/images/logo.png" alt="" /></div>
            <div class="menu-toggle">
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="d-flex align-items-center">
               
            </div>
            <div style="margin: auto">
                
            </div>
            <div class="header-part-right">  
                <h4 class="mt-3 mr-3 " id="userNameDisplay"></h4> 
                <a class="link-icon mr-1" href="../../html/sessions/signin.html" style="font-size:xx-large; color: brown;"><i class="fa-solid fa-power-off"></i></a>
            </div>
        </div>
        
        <!-- header top menu end-->
        <div class="horizontal-bar-wrap">
            <div class="header-topnav">
                <div class="container-fluid bar-views">
                    <div class="topnav rtl-ps-none" id="" data-perfect-scrollbar="" data-suppress-scroll-x="true">
                        <ul class="menu float-left">
                            <li class="views" id="nuevoCaso">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Nuevo caso</label>
                                        <a href="nuevoCaso.html"><i class="nav-icon mr-2 i-Library text-white"></i> <span class="text-white">Nuevo caso</span> </a>
                                    </div>
                                </div>
                            </li>
                            <li class="views" id="casosPendientes">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Casos pendientes</label><a href="casosPendientes.html"><i class="nav-icon i-File-Horizontal-Text mr-2 text-white"></i> <span class="text-white">Casos Pendientes</span></a>
                                       
                                    </div>
                                </div>
                            </li>
                            <li class="views" id="casosGestion">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Casos en Gestión</label>
                                        <a href="casosEnGestion.html"><i class="nav-icon mr-2 i-Receipt text-white"></i><span class="text-white">Casos en Gestión</span></a>
                                    </div>
                                </div>
                            </li>
                            <li class="views" id="baseUnica">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Base única</label>
                                        <a href="baseUnica.html"><i class="nav-icon i-File-Horizontal-Text mr-2 text-white"></i> <span class="text-white">Base única</span></a>
                                    </div>
                                </div>
                            </li>
                            <li class="views" id="estadisticas">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Estadísticas</label>
                                        <a href="estadisticas.html"><i class="nav-icon mr-2 i-Bar-Chart-5 text-white"></i> <span class="text-white">Estadísticas</span></a>
                                    </div>
                                </div>
                            </li>
                            <li class="views" id="facturacion">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Facturación</label>
                                        <a href="facturacion.html"><i class="nav-icon mr-2 i-Windows-2 text-white"></i><span class="text-white">Facturación</span></a>
                                    </div>
                                </div>
                            </li>
                            <li class="views" id="casosPas">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Mis Casos</label>
                                        <a href="casosPas.html"><i class="nav-icon i-File-Horizontal-Text mr-2 text-white"></i> <span class="text-white">Mis Casos</span></a>
                                    </div>
                                </div>
                            </li>
                            <li class="views" id="novedades">
                                <div>
                                    <div>
                                        <label class="toggle" for="drop-2">Novedades</label>
                                        <a href="novedades.html"><i class="nav-icon i-File-Horizontal-Text mr-2 text-white"></i> <span class="text-white">Novedades</span></a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- =============== Horizontal bar End ================-->
        <div class="main-content-wrap d-flex flex-column">
            <!-- ============ Body content start ============= -->
            <div class="main-content">
                <div class="row mb-4">
                    <div class="col-md-12 d-flex justify-content-end"> 
                        <button id="authorize_button" class="btn btn-secondary" onclick="handleAuthClick()">A</button>
                    </div>
                </div>
                <div class="inbox-main-sidebar-container" data-sidebar-container="main">
                    <div class="inbox-main-content" data-sidebar-content="main">
                        <!-- SECONDARY SIDEBAR CONTAINER-->
                        <div class="inbox-secondary-sidebar-container box-shadow-1" data-sidebar-container="secondary">
                            <div data-sidebar-content="secondary">
                                <div class="inbox-secondary-sidebar-content position-relative" style="min-height: 500px">
                                    <div class="inbox-topbar box-shadow-1 perfect-scrollbar rtl-ps-none pl-3" data-suppress-scroll-y="true">
                                        <a class="link-icon d-md-none" data-sidebar-toggle="main"><i class="icon-regular i-Arrow-Turn-Left"></i></a><a class="link-icon mr-3 d-md-none" data-sidebar-toggle="secondary"><i class="icon-regular mr-1 i-Left-3"></i> </a>
                                        <div class="d-flex">     
                                          <a class="link-icon mr-3" id="saveChanges" onclick="uploadFiles(event)" style="cursor: pointer;"><i class="icon-regular i-Mail-Password"></i> Guardar</a><a class="link-icon mr-3" id='sendWhatsApp' style="cursor: pointer;"><i class="icon-regular i-Mail-Send"></i> Notificar a cliente</a> </div>
                                    </div>
                                    <div class="row">
                                    <div class="col-md-6">
                                    <div class="form-floating">
                                        <textarea class="form-control" placeholder="Escribir..." id="actualizacion" style="height: 100px"></textarea>
                                      </div>
                                   <div>
                                    <div class="form-check form-check-inline mt-5">
                                        <label class="checkbox checkbox-outline-info">
                                          
                                        </label>
                                      </div>
                                     
                                   </div>
                                   
                                   <div class="input-group mb-3" id="1" >
                                    <label class="input-group-text" for="inputGroupFile01">DNI (frente)</label>
                                    <input type="file" class="form-control" id="adjDniFrente">
                                  </div>
                                  <div class="input-group mb-3" id="2" >
                                    <label class="input-group-text" for="inputGroupFile01">DNI (dorso)</label>
                                    <input type="file" class="form-control" id="adjDniDorso">
                                  </div>
                                  <div class="input-group mb-3" id="3" >
                                    <label class="input-group-text" for="inputGroupFile01">Registro (frente)</label>
                                    <input type="file" class="form-control" id="adjRegistroFrente">
                                  </div>
                                  <div class="input-group mb-3" id="4" >
                                    <label class="input-group-text" for="inputGroupFile01">Registro (dorso)</label>
                                    <input type="file" class="form-control" id="adjRegistroDorso">
                                  </div>
                                  <div class="input-group mb-3" id="5" >
                                    <label class="input-group-text" for="inputGroupFile01">Cédula Verde (Frente)</label>
                                    <input type="file" class="form-control" id="adjCedulaVerdeFrente">
                                  </div>
                                  <div class="input-group mb-3" id="6" >
                                    <label class="input-group-text" for="inputGroupFile01">Cédula Verde (Dorso)</label>
                                    <input type="file" class="form-control" id="adjCedulaVerdeDorso">
                                  </div>
                                  <div class="input-group mb-3" id="7" >
                                    <label class="input-group-text" for="inputGroupFile01">Denuncia Administrativa</label>
                                    <input type="file" class="form-control" id="adjDenunciaAdm">
                                  </div>
                                  <div class="input-group mb-3" id="8" >
                                    <label class="input-group-text" for="inputGroupFile01">Certificado de cobertura</label>
                                    <input type="file" class="form-control" id="adjCertCobertura">
                                  </div>
                                  <div class="input-group mb-3" id="9" >
                                    <label class="input-group-text" for="inputGroupFile01">Foto Siniestro</label>
                                    <input type="file" class="form-control" id="adjFotoSiniestro">
                                  </div>
                                  <div class="input-group mb-3" id="10" >
                                    <label class="input-group-text" for="inputGroupFile01">Presupuesto</label>
                                    <input type="file" class="form-control" id="adjPresupuesto">
                                  </div>
                                  <div class="input-group mb-3" id="11" >
                                    <label class="input-group-text" for="inputGroupFile01">Contrato Social</label>
                                    <input type="file" class="form-control" id="adjContratoSoc">
                                  </div>

                            </div>
                            <div class="col-md-6">
                                <div class="form-floating">
                                    <textarea class="form-control" placeholder="Historial..." id="historial" style="height: 100px" disabled></textarea>
                                  </div>
                               <div>
                               </div>
                             <div class="">
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend "><span class="input-group-text" >Teléfono</span></div>
                                    <input class="form-control" id="telefono" type="text" aria-describedby="basic-addon3" />
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend "><span class="input-group-text" >Mail</span></div>
                                    <input class="form-control" id="email" type="text" aria-describedby="basic-addon3" />
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend "><span class="input-group-text" >Observación</span></div>
                                    <input class="form-control" id="obs" type="text" aria-describedby="basic-addon3" />
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" >Estado</span>
                                    </div>
                                    <select class="form-control" id="estado" aria-describedby="basic-addon3">
                                        <option value="" disabled selected>Selecciona una opción</option>
                                        <option value="Ingresado">Ingresado</option>
                                        <option value="Falta documentación">Falta documentación</option>
                                        <option value="Cía que no tomamos">Cía que no tomamos</option>
                                        <option value="Faltante 3ro">Faltante 3ro</option>
                                        <option value="Contactar">Contactar</option>
                                        <option value="Cerrado">Cerrado</option>
                                        <option value="Facturado">Facturado</option>
                                        <option value="Cobrado">Cobrado</option>
                                        <!-- Añade más opciones aquí según sea necesario -->
                                    </select>
                                    
                                </div>
                             </div>

                        </div>
                            </div>
                         </div>
                        </div>
                    </div>
                            </div>
                            <!-- Secondary Inbox sidebar-->
                            <div class="inbox-secondary-sidebar perfect-scrollbar rtl-ps-none" data-sidebar="secondary"><i class="sidebar-close i-Close" data-sidebar-toggle="secondary"></i>
                                <div class="input-group mt-2 mb-3 mt-4">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">PAS</span>
                                    </div>
                                    <!-- Convierte el input en un select -->
                                    <select class="form-control" id="pasDropdown"></select>
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend "><span class="input-group-text" >Cliente</span></div>
                                    <input class="form-control" id="cliente" type="text" aria-describedby="basic-addon3" />
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend "><span class="input-group-text" >Fecha de ingreso</span></div>
                                    <input class="form-control" id="ingreso" type="text" aria-describedby="basic-addon3" />
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend "><span class="input-group-text" >Dominio</span></div>
                                    <input class="form-control" id="dominio" type="text" aria-describedby="basic-addon3" />
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend "><span class="input-group-text" >Compañia a Reclamar</span></div>
                                    <input class="form-control" id="ciaReclamar" type="text" aria-describedby="basic-addon3" />
                                </div>
                                <div class="input-group mt-2 mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text" >Tipo de Reclamo</span>
                                    </div>
                                    <select class="form-control" id="tipoReclamo" aria-describedby="basic-addon3">
                                        <option value="" disabled selected>Selecciona una opción</option>
                                        <option value="Administrativo">Administrativo</option>
                                        <option value="Mediación">Mediación</option>
                                        <option value="Mediación Express">Mediación Express</option>
                                        <!-- Añade más opciones aquí según sea necesario -->
                                    </select>
                                    
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- MAIN INBOX SIDEBAR-->
                </div>
  
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        
        document.addEventListener('DOMContentLoaded', () => {
            const userData = JSON.parse(localStorage.getItem('userData'));
        
            if (userData) {
                const permission = userData.permission; // Asumimos que este es un string con el permiso del usuario
                const name = userData.name;
                document.getElementById('userNameDisplay').innerText = `${userData.name}`;
                // Ocultar todas las pestañas inicialmente
                document.querySelectorAll('.views').forEach(view => {
                    view.style.display = 'none'; // Ocultar todas las pestañas
                });
        
                // Mostrar pestañas basadas en permisos
                if (permission === 'super usuario') {
                    document.getElementById('nuevoCaso').style.display = 'block';
                    document.getElementById('casosPendientes').style.display = 'block';
                    document.getElementById('casosGestion').style.display = 'block';
                    document.getElementById('baseUnica').style.display = 'block';
                    document.getElementById('estadisticas').style.display = 'block';
                    document.getElementById('facturacion').style.display = 'block';
                    document.getElementById('casosPas').style.display = 'block';
                    document.getElementById('novedades').style.display = 'block';
                } else if (permission === 'ejecutivo') {
                    document.getElementById('nuevoCaso').style.display = 'block';
                    document.getElementById('casosGestion').style.display = 'block';
                    document.getElementById('baseUnica').style.display = 'block';
                    document.getElementById('estadisticas').style.display = 'block';
                } else if (permission === 'mesa de entrada') {
                    document.getElementById('nuevoCaso').style.display = 'block';
                    document.getElementById('casosPendientes').style.display = 'block';
                } else if (permission === 'mediacion') {
                    document.getElementById('nuevoCaso').style.display = 'block';
                    document.getElementById('casosGestion').style.display = 'block';
                    document.getElementById('baseUnica').style.display = 'block';
                    document.getElementById('estadisticas').style.display = 'block';
                }else if (permission === 'jefe de operaciones') {
                    document.getElementById('nuevoCaso').style.display = 'block';
                    document.getElementById('casosGestion').style.display = 'block';
                    document.getElementById('baseUnica').style.display = 'block';
                    document.getElementById('estadisticas').style.display = 'block';

                }else if (permission === 'PAS') {
                    document.getElementById('casosPas').style.display = 'block';
                    document.getElementById('novedades').style.display = 'block';

                }
            } else {
                // Si no hay información de usuario, redirigir a login
                window.location.href = 'signin.html';
            }
        });

        const CLIENT_ID = '607561137784-rq84r06gop7p4hjo1nnv0q5re4fl2nff.apps.googleusercontent.com';
const API_KEY = 'AIzaSyBLuMXUjJmU3XLfErAIH-iI4pXzmSnl-0E';
const DISCOVERY_DOCS = [
    'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest',
    'https://www.googleapis.com/discovery/v1/apis/sheets/v4/rest'
];
const SCOPES = 'https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/spreadsheets';
const SPREADSHEET_ID = '1vnJXUhAGGcI8xt-83_T2K_TzJNqhz2nYdcMhilSqkWY';  // Reemplaza con tu ID de hoja de cálculo

let tokenClient;
let gapiInited = false;
let gisInited = false;

// document.getElementById('authorize_button').style.visibility = 'hidden';
// document.getElementById('signout_button').style.visibility = 'hidden';

function gapiLoaded() {
    gapi.load('client', initializeGapiClient);
}

async function initializeGapiClient() {
    await gapi.client.init({
        apiKey: API_KEY,
        discoveryDocs: DISCOVERY_DOCS,
    });
    gapiInited = true;
    maybeEnableButtons();
}

function gisLoaded() {
    tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: '',
    });
    gisInited = true;
    maybeEnableButtons();
}

function maybeEnableButtons() {
    if (gapiInited && gisInited) {
        document.getElementById('authorize_button').style.visibility = 'visible';
    }
}

function handleAuthClick() {
    tokenClient.callback = async (resp) => {
        if (resp.error !== undefined) {
            throw (resp);
        }
        document.getElementById('signout_button').style.visibility = 'hidden';
        document.getElementById('authorize_button').innerText = 'hidden';
        await listFiles();
    };

    if (gapi.client.getToken() === null) {
        tokenClient.requestAccessToken({ prompt: 'consent' });
    } else {
        tokenClient.requestAccessToken({ prompt: '' });
    }
}

function handleSignoutClick() {
    const token = gapi.client.getToken();
    if (token !== null) {
        google.accounts.oauth2.revoke(token.access_token);
        gapi.client.setToken('');
        document.getElementById('content').innerText = '';
        document.getElementById('authorize_button').innerText = 'Authorize';
        document.getElementById('signout_button').style.visibility = 'hidden';
    }
}

document.addEventListener('DOMContentLoaded', function() {
    // Inicializa Select2 en el elemento select
    $('#pasDropdown').select2({
        placeholder: 'Seleccione un nombre',
        allowClear: true,
        width: '100%'
    });

    // Realiza la solicitud fetch para obtener datos dinámicos
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const rows = data.values;
            console.log(rows);

            // Extrae los nombres de la tercera columna (índice [2]), excluyendo la primera fila (cabeceras)
            const selectedRows = rows.slice(1).map(row => row[2]);
            
            // Prepara la lista dinámica en el formato que Select2 espera (id y text)
            const listaDinamica = selectedRows.map((nombre, index) => ({
                id: nombre,
                text: nombre
            }));

            console.log('Lista Dinámica:', listaDinamica);

            // Cargar la lista dinámica en el dropdown
            $('#pasDropdown').select2({
                data: listaDinamica
            });
        })
        .catch(error => console.error('Error al cargar datos', error));
        
   

});

async function uploadFiles(e) {
    e.preventDefault();
    
    const fileIds = [
        'adjDniFrente',
        'adjDniDorso',
        'adjRegistroFrente',
        'adjRegistroDorso',
        'adjCedulaVerdeFrente',
        'adjCedulaVerdeDorso',
        'adjDenunciaAdm',
        'adjCertCobertura',
        'adjFotoSiniestro',
        'adjPresupuesto',
        'adjContratoSoc',
    ];
    console.log(fileIds)
    const urls = [];

    for (const fileId of fileIds) {
        const fileInput = document.getElementById(fileId);
        const file = fileInput.files[0];

        if (file) {
            const url = await uploadFile(file);
            if (url) {
                urls.push(url);
            } else {
                console.error(`Error al subir ${fileId}`);
            }
        } else {
            urls.push(''); // Si no hay archivo, guarda null
        }
    }
    console.log(urls)
    await saveDataToSheetWithFiles(urls);
   // await saveDataToSheet();
  //  await saveDataToSheet2();
   // await saveFileURLsToSheet(urls); // Guardar todas las URLs en Google Sheets
}

async function uploadFile(file) {
    const metadata = {
        'name': file.name,
        'mimeType': file.type
    };

    const formData = new FormData();
    formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
    formData.append('file', file);

    try {
        const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
            method: 'POST',
            headers: new Headers({ 'Authorization': 'Bearer ' + gapi.client.getToken().access_token }),
            body: formData
        });

        if (response.ok) {
            const result = await response.json();
            const fileURL = `https://drive.google.com/file/d/${result.id}/view?usp=sharing`;
            alert(`Archivo ${file.name} subido con éxito. ID: ${result.id}`);
            return fileURL;
        } else {
            console.error('Error al subir archivo:', response.statusText);
        }
    } catch (error) {
        console.error('Error al subir archivo:', error);
    }
    return null; // En caso de error
}

async function saveDataToSheetWithFiles(urls) {

    console.log("pasdropdonw",document.getElementById('pasDropdown').value )
    // Datos para las columnas de A a H
    const valuesAtoH = [
        document.getElementById('ingreso') ? document.getElementById('ingreso').value : "",
        document.getElementById('pasDropdown') ? document.getElementById('pasDropdown').value : "",
        document.getElementById('cliente') ? document.getElementById('cliente').value : "",
        document.getElementById('dominio') ? document.getElementById('dominio').value : "",
        document.getElementById('ciaReclamar') ? document.getElementById('ciaReclamar').value : "",
        document.getElementById('telefono') ? document.getElementById('telefono').value : "",
        document.getElementById('email') ? document.getElementById('email').value : "",
        document.getElementById('obs') ? document.getElementById('obs').value : "",
    ];
    console.log(valuesAtoH)
    // URLs de archivos adjuntos para llenar de I a S
    const filledUrls = urls.map(url => url || ''); // Reemplaza los valores vacíos con ''
    while (filledUrls.length < 11) {
        filledUrls.push(''); // Asegura que haya exactamente 11 columnas en I:S
    }

    // Datos para las columnas de T a V
    const valuesTtoV = [
        document.getElementById('tipoReclamo') ? document.getElementById('tipoReclamo').value : "",
        document.getElementById('actualizacion') ? document.getElementById('actualizacion').value : "",
        document.getElementById('estado') ? document.getElementById('estado').value : ""
    ];

    // Combina todos los valores en un solo array
    const values = [...valuesAtoH, ...filledUrls, ...valuesTtoV];

    const spreadsheetId = '1QzbFeGvzlzxVYN53G_5Dkl7Lji41Q6_0iMCqhVJhHhs'; // Reemplaza con tu ID de hoja de cálculo
    const range = `Respuestas de formulario 1!A:V`; // Especifica todo el rango de A a V

    const body = {
        values: [values] // Agrega la fila combinada
    };

    try {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}:append?valueInputOption=USER_ENTERED`, {
            method: 'POST', // Cambia a 'POST' para usar el método 'append'
            headers: new Headers({
                'Authorization': 'Bearer ' + gapi.client.getToken().access_token,
                'Content-Type': 'application/json'
            }),
            body: JSON.stringify(body)
        });

        if (response.ok) {
            const result = await response.json();
            console.log('Fila guardada con éxito:', result);
        } else {
            console.error('Error al guardar la fila:', response.statusText);
        }
    } catch (error) {
        console.error('Error al guardar la fila:', error);
    }
}


//Segun el nombre del pas buscar su ejecutivo
const spreadsheetId = '1QzFSJiC-Aax_FmXePVAmu92CB_0cScvWQROeh0xi5rE';
const apiKey = 'AIzaSyBLuMXUjJmU3XLfErAIH-iI4pXzmSnl-0E'; //  clave de API
const range = 'sheet1'; // 
// URL de la API de Google Sheets
const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;
document.getElementById('sendWhatsApp').addEventListener('click', function() {
    const mensaje = document.getElementById('actualizacion').value;
    console.log(mensaje)
    const phoneNumber = '542994707809'; // Reemplaza con el número de teléfono completo
    const message = `¡Buenos dias! Este es la ultima actualización de su Caso: ${mensaje}`;
    
    // Codificar el mensaje para URL
    const encodedMessage = encodeURIComponent(message);
    
    // Construir la URL
    const whatsappURL = `https://api.whatsapp.com/send?phone=${phoneNumber}&text=${encodedMessage}`;
    
    // Abrir la URL en una nueva pestaña o ventana
    window.open(whatsappURL, '_blank');
  });

$('#derivado').on('click', function() {
    fetch(url)
      .then(response => response.json())
      .then(data => {
        const rows = data.values; // Supongo que 'values' es el array de filas de Google Sheets
        console.log(rows);
  
        // Filtrar por el valor del campo 'pas' y obtener el 'ejecutivo' correspondiente
        const nameToFind = document.getElementById('pas').value; // El nombre que quieres buscar (sin apellido)
console.log(nameToFind)
        // Filtrar por el nombre en la primera columna (suponiendo que 'pas' está en la columna 0)
        const result = rows.filter(row => {
            const fullName = row[2];
            console.log(fullName) // Aquí asumimos que 'row[0]' contiene el nombre y apellido
            const nameToFindStr = String(nameToFind).toLowerCase();
            console.log(nameToFindStr)
            // Dividir el nombre completo en palabras y comparar solo el primer nombre
            const nameParts = fullName.split(/\s+/); 
            console.log(nameParts)// Usamos expresión regular para dividir por espacios
          //  const firstName = nameParts[0]; // Tomamos la primera palabra (el primer nombre)
             return nameParts.some(part => part.toLowerCase() === nameToFindStr); // Compara cada parte con el nombre// Comparar solo el primer nombre
          });
          console.log(result)
        if (result.length > 0) {
          // Encontramos el ejecutivo en la fila filtrada
          const ejecutivo = result[0][15]; // Suponiendo que el 'ejecutivo' está en la segunda columna (índice 1)
          const nroInterno = 'INT0009'
          console.log('Ejecutivo encontrado:', ejecutivo);
          saveDataToSheet2((rowIndex+2),ejecutivo,nroInterno);
        } else {
          console.log('No se encontró el ejecutivo para el PAS:', pasToFind);
        }
        
      })
      .catch(error => {
        console.error('Error al obtener los datos:', error);
      });
      async function saveDataToSheet2() {
        // Extraer valores de los campos del formulario
        const values = [
            document.getElementById('tipoReclamo') ? document.getElementById('tipoReclamo').value : "",
            document.getElementById('historial') ? document.getElementById('historial').value : "",
            document.getElementById('estado') ? document.getElementById('estado').value : "",
           
        ];
    
        const spreadsheetId = '1QzbFeGvzlzxVYN53G_5Dkl7Lji41Q6_0iMCqhVJhHhs'; // Reemplaza con tu ID de hoja de cálculo
        const range = `Respuestas de formulario 1!T:V`; // Rango a actualizar
    
        const body = {
            values: [values]
        };
    
        console.log('Datos a enviar:', body);
    
        try {
            const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?valueInputOption=USER_ENTERED`, {
                method: 'POST',
                headers: new Headers({
                    'Authorization': 'Bearer ' + gapi.client.getToken().access_token,
                    'Content-Type': 'application/json'
                }),
                body: JSON.stringify(body)
            });
    
            if (response.ok) {
                const result = await response.json();
                console.log('Filas guardadas con éxito:', result);
            } else {
                console.error('Error al guardar las filas:', await response.text());
            }
        } catch (error) {
            console.error('Error al guardar las filas:', error);
        }
    }

  });
        </script>
    <!-- ============ Search UI End ============= -->
    <script src="../../dist-assets/js/plugins/jquery-3.3.1.min.js"></script>
    <script src="../../dist-assets/js/plugins/bootstrap.bundle.min.js"></script>
    <script src="../../dist-assets/js/plugins/perfect-scrollbar.min.js"></script>
    <script src="../../dist-assets/js/scripts/script.min.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script src="../../dist-assets/js/plugins/sweetalert2.min.js"></script>
    <script src="../../dist-assets/js/scripts/sweetalert.script.min.js"></script>
    <script src="../../dist-assets/js/scripts/sidebar-horizontal.script.js"></script>
    <script src="../../dist-../../dist-assets/js/scripts/sidebar.script.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

</body>

</html>